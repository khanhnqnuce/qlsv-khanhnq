@using System.Globalization
@model FDI.Areas.Admin.Models.UserAdministration.DetailsViewModel
@{
    ViewBag.Title = "Quản lý tài khoản quản trị" + Model.DisplayName;
    Layout = "~/Areas/Admin/Views/Shared/_LayoutNew.cshtml";
}
<style>
    button {
        color: white;
    }
</style>
<section id="gridItems" class="vbox">
    <section class="scrollable wrapper w-f">
        <section class="panel panel-default">
            <header class="panel-heading font-bold">Quản lý quản trị viên: @Model.DisplayName [@Model.Status]</header>
            <div class="panel-body">
                <div class="searchbox" style="padding-right: 5px; float: left;">
                    @Html.ActionLink("Quay lại danh sách", "Index", "UserAdministration", new { }, new { @class = "btn btn-sm btn-success", @id = "btn_back" })
                </div>
                <div class="manage">
                    
                    <div style="float: right; padding-left: 5px;">
                        @Html.ActionLink("Đổi mật khẩu", "Password", "UserAdministration", new { id = Model.User.ProviderUserKey }, new { @class = "btn btn-sm btn-success" })
                    </div>
                    <div style="float: right; padding-left: 5px; padding-right: 5px;"> 
                        @using (Html.BeginForm("DeleteUser", "UserAdministration", new { id = Model.User.ProviderUserKey }))
                        {
                            <button type="submit" class="btn btn-sm btn-success">Xóa tài khoản</button>
                        } 
                    </div>
                    <div style="float: right; padding-left: 5px;">

                        @using (Html.BeginForm("Unlock", "UserAdministration", new { id = Model.User.ProviderUserKey }))
                        {
                            if (ViewBag.IsLockedOut == true)
                            {
                            <button type="submit" class="btn btn-sm btn-success">Khôi phục tài khoản</button>
                            }
                            else
                            {
                            <button type="submit" class="btn btn-sm btn-success">Khóa tài khoản</button>
                            }
                        }
                    </div>
                    <div style="float: right;">
                        @using (Html.BeginForm("ChangeApproval", "UserAdministration", new { id = Model.User.ProviderUserKey }))
                        {
                            @Html.Hidden("isApproved", !Model.User.IsApproved)
                            <button type="submit" class="btn btn-sm btn-success">@(Model.User.IsApproved ? "Hủy duyệt" : "Duyệt") tài khoản</button>
                        }

                    </div>
                </div>
            </div>
            @using (Html.BeginForm("Details", "UserAdministration", new { id = Model.User.ProviderUserKey }))
            {
                <fieldset class="forms">
                    <table class="gridView" cellspacing="1">
                        <tr>
                            <td style="width: 120px;">
                                <label>Tài khoản</label></td>
                            <td>@Model.User.UserName</td>
                        </tr>

                        <tr>
                            <td>
                                <label>Email</label></td>
                            <td>@Model.User.Email</td>
                        </tr>

                        <tr>
                            <td>
                                <label>Hoạt động cuối</label></td>
                            <td>@Model.User.LastActivityDate.ToString("dd/MM/yyyy hh:mm:ss tt")</td>
                        </tr>

                        <tr>
                            <td>
                                <label>Đăng nhập cuối</label></td>
                            <td>@Model.User.LastLoginDate.ToString("dd/MM/yyyy hh:mm:ss tt")</td>
                        </tr>

                        <tr>
                            <td>
                                <label>Ngày tạo</label></td>
                            <td>@Model.User.CreationDate.ToString("dd/MM/yyyy hh:mm:ss tt")</td>
                        </tr>

                        <tr>
                            <td>
                                <label>Thay đổi email</label></td>
                            <td>@Html.TextBox("email", Model.User.Email, new { @class = "form-control" })</td>
                        </tr>

                        <tr>
                            <td>
                                <label>Ghi chú</label></td>
                            <td>@Html.TextArea("comments", Model.User.Comment, new { @class = "form-control Description valid" })</td>
                        </tr>
                        <tr>
                            <td colspan="2" class="submit">

                                <button type="submit" class="btn btn-sm btn-success">Lưu thông tin</button>

                            </td>
                        </tr>
                    </table>
                </fieldset>
            }

            <fieldset class="forms">
                <header class="panel-heading font-bold">Danh sách vai trò đang được sử dụng</header>
                <table class="gridView" cellspacing="1" width="100%">
                    <tr>
                        <th>Tên vai trò</th>
                        <th>Trạng thái</th>
                        <th>Quản lý</th>
                    </tr>
                    @foreach (var role in Model.Roles)
                    {
                        <tr>
                            <td>@Html.ActionLink(role.Key, "Role", new { id = role.Key })</td>
                            <td>@((role.Value) ? "Đang sử dụng" : "Không sử dụng")</td>
                            <td>

                                @if (role.Value)
                                {
                                    using (Html.BeginForm("RemoveFromRole", "UserAdministration", new { id = Model.User.ProviderUserKey, role = role.Key }))
                                    {
                                    <button type="submit" class="btn btn-sm btn-success">Xóa vai trò</button>
                                    }
                                }
                                else
                                {
                                    using (Html.BeginForm("AddToRole", "UserAdministration", new { id = Model.User.ProviderUserKey, role = role.Key }))
                                    {
                                    <button type="submit" class="btn btn-sm btn-success">Thêm vai trò</button>
                                    }
                                }

                            </td>
                        </tr>
                    }
                </table>
            </fieldset>
        </section>
    </section>
</section>
